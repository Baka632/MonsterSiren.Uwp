<UserControl
    x:Class="MonsterSiren.Uwp.Views.FavoritePageParts.SongFavoriteSection"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:favoriteModels="using:MonsterSiren.Uwp.Models.Favorites"
    xmlns:helpers="using:Baka632.Library.Uwp.CSharp.Helpers"
    xmlns:local="using:MonsterSiren.Uwp.Views.FavoritePageParts"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:services="using:MonsterSiren.Uwp.Services"
    xmlns:viewmodels="using:MonsterSiren.Uwp.ViewModels"
    x:Name="Self"
    d:DesignHeight="300"
    d:DesignWidth="400"
    Loaded="OnSongFavoriteSectionLoaded"
    Unloaded="OnSongFavoriteSectionUnloaded"
    mc:Ignorable="d">
    <UserControl.Resources>
        <MenuFlyout
            x:Name="SongContextFlyout"
            x:FieldModifier="Public"
            Opening="OnSongContextFlyoutOpening">
            <MenuFlyoutItem
                x:Uid="PlayMusicTextBlock"
                Command="{x:Bind ViewModel.PlayForSongItemCommand}"
                CommandParameter="{x:Bind ViewModel.SelectedSongItem, Mode=OneWay}"
                Icon="Play" />
            <MenuFlyoutItem
                x:Uid="PlayNext"
                Command="{x:Bind ViewModel.PlayNextForSongItemCommand}"
                CommandParameter="{x:Bind ViewModel.SelectedSongItem, Mode=OneWay}"
                Icon="Forward" />
            <MenuFlyoutSubItem Tag="Placeholder_For_AddTo" />
            <MenuFlyoutSeparator />
            <MenuFlyoutItem
                x:Uid="RemoveFromFavorite"
                Command="{x:Bind ViewModel.RemoveSongFromFavoriteCommand}"
                CommandParameter="{x:Bind ViewModel.SelectedSongItem, Mode=OneWay}"
                Icon="UnFavorite" />
            <MenuFlyoutItem
                x:Uid="DownloadTextBlock"
                Command="{x:Bind ViewModel.DownloadForSongItemCommand}"
                CommandParameter="{x:Bind ViewModel.SelectedSongItem, Mode=OneWay}"
                Icon="Download" />
            <MenuFlyoutItem
                x:Uid="CopySongName"
                Command="{x:Bind ViewModel.CopySongNameToClipboardCommand}"
                CommandParameter="{x:Bind ViewModel.SelectedSongItem, Mode=OneWay}"
                Icon="Copy" />
            <MenuFlyoutSeparator />
            <MenuFlyoutItem
                x:Uid="SelectForSongList"
                Command="{x:Bind ViewModel.StartSongListMultipleSelectionCommand}"
                CommandParameter="{x:Bind SongList}">
                <MenuFlyoutItem.Icon>
                    <FontIcon Glyph="&#xE762;" />
                </MenuFlyoutItem.Icon>
            </MenuFlyoutItem>
        </MenuFlyout>

        <MenuFlyout
            x:Name="SongSelectionFlyout"
            x:FieldModifier="Public"
            Opening="OnSongSelectionFlyoutOpening">
            <MenuFlyoutItem
                x:Uid="PlayMusicTextBlock"
                Command="{x:Bind ViewModel.PlaySongListSelectedItemCommand}"
                Icon="Play" />
            <MenuFlyoutItem
                x:Uid="PlayNext"
                Command="{x:Bind ViewModel.PlayNextForSelectedItemCommand}"
                Icon="Forward" />
            <MenuFlyoutSubItem Tag="Placeholder_For_AddTo" />
            <MenuFlyoutItem
                x:Uid="DownloadTextBlock"
                Command="{x:Bind ViewModel.DownloadForSongListSelectedItemCommand}"
                Icon="Download" />
            <MenuFlyoutItem
                x:Uid="RemoveFromFavorite"
                Command="{x:Bind ViewModel.RemoveSongListSelectedItemFromFavoriteCommand}"
                Icon="UnFavorite" />
            <MenuFlyoutSeparator />
            <MenuFlyoutItem
                x:Uid="SelectAllForSongList"
                Command="{x:Bind ViewModel.SelectAllSongListCommand}"
                Icon="SelectAll" />
            <MenuFlyoutItem
                x:Uid="DeselectAllForSongList"
                Command="{x:Bind ViewModel.DeselectAllSongListCommand}"
                Icon="ClearSelection" />
            <MenuFlyoutItem
                x:Uid="DeselectForSongList"
                Command="{x:Bind ViewModel.StopSongListMultipleSelectionCommand}"
                Icon="Cancel" />
        </MenuFlyout>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <StackPanel
            Grid.Row="0"
            Margin="0,10,0,5"
            Orientation="Horizontal">
            <Button
                Margin="0,0,5,0"
                AccessKey="0"
                Background="Transparent"
                Command="{x:Bind ViewModel.PlayForSongFavoriteCommand}"
                IsEnabled="{x:Bind helpers:XamlHelper.ReverseBoolean(IsSongFavoriteEmpty), Mode=OneWay}">
                <StackPanel Orientation="Horizontal">
                    <SymbolIcon
                        Margin="0,0,5,0"
                        HorizontalAlignment="Center"
                        Symbol="Play" />
                    <TextBlock x:Uid="PlayMusicTextBlock" HorizontalAlignment="Center" />
                </StackPanel>
            </Button>

            <Button
                Margin="0,0,5,0"
                AccessKey="1"
                Background="Transparent"
                IsEnabled="{x:Bind helpers:XamlHelper.ReverseBoolean(IsSongFavoriteEmpty), Mode=OneWay}">
                <StackPanel Orientation="Horizontal">
                    <SymbolIcon
                        Margin="0,0,5,0"
                        HorizontalAlignment="Center"
                        Symbol="Add" />
                    <TextBlock x:Uid="AddToPlaylistOrNowPlayingTextBlock" HorizontalAlignment="Center" />
                </StackPanel>
                <Button.Flyout>
                    <MenuFlyout Opening="OnListViewItemSongContextFlyoutOpening" />
                </Button.Flyout>
            </Button>

            <Button AccessKey="2" Background="Transparent">
                <Button.Flyout>
                    <MenuFlyout>
                        <MenuFlyoutItem
                            x:Uid="DownloadTextBlock"
                            Command="{x:Bind ViewModel.DownloadForSongFavoriteCommand}"
                            Icon="Download"
                            IsEnabled="{x:Bind helpers:XamlHelper.ReverseBoolean(IsSongFavoriteEmpty), Mode=OneWay}" />
                    </MenuFlyout>
                </Button.Flyout>
                <Button.Content>
                    <SymbolIcon Symbol="More" />
                </Button.Content>
            </Button>
        </StackPanel>

        <ListView
            x:Name="SongList"
            Grid.Row="1"
            Margin="0,0,0,10"
            x:FieldModifier="Public"
            AllowDrop="True"
            CanDragItems="True"
            CanReorderItems="True"
            DragItemsStarting="OnSongListViewItemsDragStarting"
            ItemsSource="{x:Bind services:FavoriteService.SongFavoriteList.Items}">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="favoriteModels:SongFavoriteItem">
                    <Grid
                        Background="Transparent"
                        ContextFlyout="{Binding ElementName=Self, Path=ViewModel.SelectedSongListItemContextFlyout, Mode=OneWay}"
                        DataContext="{x:Bind}"
                        DoubleTapped="OnListViewItemGridDoubleTapped"
                        RightTapped="OnListViewItemGridRightTapped">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.Resources>
                            <Style x:Key="SongDefaultTextStyle" TargetType="TextBlock">
                                <Setter Property="Margin" Value="0,0,5,0" />
                                <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Setter Property="Grid.Column" Value="1" />
                            </Style>
                        </Grid.Resources>

                        <FontIcon
                            x:Uid="InvaildItemTooltip"
                            Grid.Column="0"
                            Margin="0,0,5,0"
                            Glyph="&#xE7BA;"
                            Visibility="{x:Bind IsCorruptedItem}" />

                        <TextBlock
                            Style="{StaticResource SongDefaultTextStyle}"
                            Text="{x:Bind SongTitle}"
                            ToolTipService.ToolTip="{x:Bind SongTitle}"
                            Visibility="{x:Bind helpers:XamlHelper.ReverseVisibility(IsCorruptedItem)}" />
                        <TextBlock
                            FontStyle="Italic"
                            Style="{StaticResource SongDefaultTextStyle}"
                            Text="{x:Bind SongTitle}"
                            ToolTipService.ToolTip="{x:Bind SongTitle}"
                            Visibility="{x:Bind IsCorruptedItem}" />

                        <TextBlock
                            Grid.Column="2"
                            Margin="0,0,5,0"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            DataContext="{x:Bind}"
                            TextTrimming="CharacterEllipsis"
                            ToolTipService.ToolTip="{x:Bind AlbumTitle}">
                            <Hyperlink
                                Click="OnAlbumTitleHyperlinkClick"
                                Foreground="{ThemeResource SystemBaseHighColor}"
                                UnderlineStyle="None">
                                <Run Text="{x:Bind AlbumTitle}" />
                            </Hyperlink>
                        </TextBlock>

                        <StackPanel
                            Grid.Column="3"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Orientation="Horizontal">
                            <TextBlock
                                Margin="0,0,5,0"
                                VerticalAlignment="Center"
                                Text="{x:Bind SongDuration, Converter={StaticResource TimeSpanToStringConverter}}" />

                            <Button
                                VerticalAlignment="Center"
                                Background="Transparent"
                                BorderThickness="0"
                                DataContext="{x:Bind}"
                                Flyout="{Binding ElementName=Self, Path=ViewModel.SelectedSongListItemContextFlyout, Mode=OneWay}"
                                Tapped="OnMoreOptionButtonTapped">
                                <SymbolIcon Symbol="More" />
                            </Button>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <StackPanel
            Grid.Row="1"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Visibility="{x:Bind helpers:XamlHelper.ToVisibility(IsSongFavoriteEmpty), Mode=OneWay}">
            <FontIcon
                Margin="0,0,0,10"
                FontSize="60"
                Glyph="&#xE728;" />
            <TextBlock x:Uid="FavoriteEmpty" FontSize="20" />
        </StackPanel>
    </Grid>
</UserControl>
